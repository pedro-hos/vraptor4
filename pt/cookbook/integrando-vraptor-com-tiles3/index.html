<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Integrando o VRaptor com Tiles 3</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../../docs/guia-de-1-minuto/">Documentação</a></li> <li><a href="../aceitando-urls-com-ou-sem-barra-no-final">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Cookbook</h1> <ul> <li> <a href="../aceitando-urls-com-ou-sem-barra-no-final"> Aceitando URLs com ou sem barra no final </a> </li> <li> <a href="../construindo-uma-aplicacao-web-com-java8-vraptor4-wildfly"> Construindo uma Aplicação Web com Java 8 e VRaptor 4 no Wildfly </a> </li> <li> <a href="../evitando-que-o-browser-faca-cache-das-paginas"> Evitando que o browser faça cache das páginas </a> </li> <li> <a href="../usando-o-header-referer-para-fazer-redirecionamentos"> Usando o Header Referer para fazer redirecionamentos </a> </li> <li> <a href="."> Integrando o VRaptor com Tiles 3 </a> </li> </ul> </nav> <main class="container"> <h1 id="por-otvio-garcia">por Otávio Garcia</h1> <p>Apache Tiles é um framework que implementa o design pattern Composite View. Com ele é possível você criar templates para sua aplicação de forma bem simples. Mais informações você encontrará no <a href="http://tiles.apache.org">site do projeto</a>.</p> <p>O primeiro passo é incluir em seu projeto Maven o artefato abaixo. Se você não usa Maven, você pode ir no <a href="http://tiles.apache.org">site do Tiles</a> e baixar os arquivos manualmente.</p> <pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.tiles<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tiles-extras<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.0.0<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- ou a última versão --&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre> <p>E depois adicionar o listener que informa ao tiles que a aplicação está inicializada:</p> <pre><code class="language-xml"><span class="nt">&lt;listener&gt;</span>
    <span class="nt">&lt;listener-class&gt;</span>org.apache.tiles.extras.complete.CompleteAutoloadTilesListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="nt">&lt;/listener&gt;</span></code></pre> <p>E por último o servlet que irá responder às requisições do Tiles. No exemplo abaixo, qualquer requisição para a URL <code>*.tiles</code> será direcionada para os templates do Tiles.</p> <pre><code class="language-xml"><span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>TilesDispatchServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.apache.tiles.web.util.TilesDispatchServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>TilesDispatchServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>*.tiles<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span></code></pre> <p>Desta forma já temos o Tiles atendendo as requisições.</p> <p>Por padrão o VRaptor faz o forward para JSPs. Então precisaremos sobrescrever o comportamento da classe <code>DefaultPathResolver</code> para fazer o forward para o Tiles, usando o Servlet que criamos anteriormente.</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TilesPathResolver</span> <span class="kd">extends</span> <span class="n">DefaultPathResolver</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">protected</span> <span class="nf">TilesPathResolver</span><span class="o">(</span><span class="n">FormatResolver</span> <span class="n">resolver</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">resolver</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getPrefix</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getExtension</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"tiles"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Com isso, se você requisitar o método <code>ClienteController.formulario</code>, o VRaptor irá efetuar o forward para o template <code>cliente.formulario</code>. Basta então criarmos o template para atender ao <code>forward</code> no arquivo <code>/WEB-INF/tiles.xml</code>:</p> <pre><code class="language-xml"><span class="nt">&lt;definition</span> <span class="na">name=</span><span class="s">"/cliente/formulario"</span> <span class="na">template=</span><span class="s">"/WEB-INF/jsp/layouts/basic.jsp"</span><span class="nt">&gt;</span>
    [...]
<span class="nt">&lt;/definition&gt;</span></code></pre> </main> <script src="/js/headers.min.js"></script> </body> </html>