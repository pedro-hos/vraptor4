<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Usando o Header Referer para fazer redirecionamentos</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../../docs/guia-de-1-minuto/">Documentação</a></li> <li><a href="../aceitando-urls-com-ou-sem-barra-no-final">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Cookbook</h1> <ul> <li> <a href="../aceitando-urls-com-ou-sem-barra-no-final"> Aceitando URLs com ou sem barra no final </a> </li> <li> <a href="../construindo-uma-aplicacao-web-com-java8-vraptor4-wildfly"> Construindo uma Aplicação Web com Java 8 e VRaptor 4 no Wildfly </a> </li> <li> <a href="../evitando-que-o-browser-faca-cache-das-paginas"> Evitando que o browser faça cache das páginas </a> </li> <li> <a href="."> Usando o Header Referer para fazer redirecionamentos </a> </li> <li> <a href="../integrando-vraptor-com-tiles3"> Integrando o VRaptor com Tiles 3 </a> </li> </ul> </nav> <main class="container"> <p>Geralmente quando você clica em um link, ou submete um formulário, o browser envia uma requisição para o servidor da sua aplicação, colocando um Header chamado Referer, que contém qual é a página atual, que originou a requisição. Você pode usar esse Header com o VRaptor, para fazer os redirecionamentos:</p> <pre><code class="language-java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">br</span><span class="o">.</span><span class="na">com</span><span class="o">.</span><span class="na">caelum</span><span class="o">.</span><span class="na">vraptor</span><span class="o">.</span><span class="na">view</span><span class="o">.</span><span class="na">Results</span><span class="o">.</span><span class="na">referer</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShoppingController</span> <span class="o">{</span>
    <span class="c1">//...</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">adicionaItem</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">validator</span><span class="o">.</span><span class="na">checking</span><span class="o">(...);</span>
        <span class="n">validator</span><span class="o">.</span><span class="na">onErrorUse</span><span class="o">(</span><span class="n">referer</span><span class="o">()).</span><span class="na">forward</span><span class="o">();</span>

        <span class="n">dao</span><span class="o">.</span><span class="na">adiciona</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>

        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">referer</span><span class="o">()).</span><span class="na">redirect</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>O problema em usar o Referer é que ele não é obrigatório. Então quando o Referer não vem na requisição, o VRaptor vai lançar uma IllegalStateException, e assim você pode especificar uma outra lógica para ir caso o Referer não seja especificado:</p> <pre><code class="language-java"><span class="k">try</span> <span class="o">{</span>
    <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">referer</span><span class="o">()).</span><span class="na">redirect</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalStateException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">logic</span><span class="o">()).</span><span class="na">redirectTo</span><span class="o">(</span><span class="n">HomeController</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">index</span><span class="o">();</span>
<span class="o">}</span></code></pre> <p>Ou você pode usar o <code>on(IllegalStateException.class)</code> pra fazer isso de forma fluente:</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">referer</span><span class="o">())</span>
    <span class="o">.</span><span class="na">redirect</span><span class="o">()</span>
    <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">IllegalStateException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">redirectTo</span><span class="o">(</span><span class="n">HomeController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">index</span><span class="o">();</span></code></pre> </main> <script src="/js/headers.min.js"></script> </body> </html>