<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Guia de 1 minuto</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="./">Documentação</a></li> <li><a href="../../cookbook/aceitando-urls-com-ou-sem-barra-no-final">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentação</h1> <ul> <li><a href=".">Guia inicial de 1 minuto</a></li> <li><a href="../guia-de-10-minutos">Guia inicial de 10 minutos</a></li> <li><a href="../controllers-rest">Controllers Rest</a></li> <li><a href="../componentes">Componentes</a></li> <li><a href="../conversores">Conversores</a></li> <li><a href="../validacao">Validação</a></li> <li><a href="../interceptadores">Interceptadores</a></li> <li><a href="../eventos">Eventos</a></li> <li><a href="../trabalhando-com-a-view">Trabalhando com a View</a></li> <li><a href="../download-e-upload">Download e Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencias-e-pre-requisitos">Dependências e pré requisitos</a></li> <li><a href="../testando-componentes-e-controllers">Testando Componentes e Controllers</a></li> <li><a href="../migrando-de-um-projeto-com-vraptor3">Migrando de um projeto com VRaptor 3</a></li> <li><a href="../contribuindo-com-o-vraptor">Contribuindo com o VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="um-controller-simples">Um Controller simples</h1> <p>Chamaremos de <code>Controller</code> as classes contendo a lógica de negócio do seu sistema. São as classes que alguns frameworks podem vir a chamar de actions ou services, apesar de não significarem exatamente a mesma coisa.</p> <p>Com o jar ou dependencia do VRaptor em seu projeto, basta criar os seus controllers para receber as requisições e começar a construir seu sistema.</p> <p>Um controller simples seria:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ClientDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">form</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// código que carrega dados para checkboxes, selects, etc</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Client</span> <span class="n">custom</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">custom</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">listAll</span><span class="o">():</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Client</span> <span class="nf">view</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Anotando seu controller com <code>@Controller</code>, seus métodos públicos ficarão disponíveis para receber requisições web.</p> <p>Você pode injetar as dependências da sua classe adicionando a anotação <code>@Inject</code>, e o VRaptor com CDI vai se encarregar de criar ou localizar essas dependências pra você. Outra alternativa é adicionar o <code>@Inject</code> no construtor de sua classe, para que isso funcione você precisará adicionar também um construtor default, por exemplo:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ClientDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">ClientsController</span><span class="o">(</span><span class="n">ClientDao</span> <span class="n">dao</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dao</span> <span class="o">=</span> <span class="n">dao</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @deprecated CDI eyes only</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">ClientsController</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// métodos do controller</span>
<span class="o">}</span></code></pre> <p>Para a aplicação não há diferença usar a injeção via construtor ou no atributo da classe. Porém utilizando a injeção via construtor será útil para você escrever seus testes unitários, o que veremos <a href="../testando-componentes-e-controllers">mais adiante</a>.</p> <p>Todos os métodos públicos do seu controller estarão acessíveis pela web. Por exemplo, o método <code>form</code> pode ser acessado pela URI <code>/clients/form</code> e vai redirecionar para a jsp <code>/WEB-INF/jsp/clients/form.jsp</code>.</p> <p>Você pode receber parâmetros no seu método e o VRaptor tentará popular os campos dos parâmetro de acordo com a requisição. Se houver na requisição: </p> <pre><code>custom.name=Paulo Silveira
custom.address=R.Vergueiro
</code></pre> <p>Então os campos <code>name</code> e <code>address</code> do parâmetro <code>Client</code> que chamamos de <code>custom</code> no método <code>add</code> serão populados com <code>Paulo Silveira</code> e <code>R.Vergueiro</code> via setters ou construtor, utilizando parâmetros com os mesmos nomes dos atributos. </p> <p>Um exemplo via setters seria:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Client</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Ou você pode preferir receber os valores pelo construtor. Isso também funciona desde que respeite a regra de usar os mesmos nomes dos parâmetros do request, por exemplo:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Client</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Com isso podemos receber o custom como parâmetro do método <code>add</code> e o VRaptor vai cuidar de instanciar seus atributos:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Client</span> <span class="n">custom</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">custom</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>Para este caso a URL será <code>/clients/add</code> e a view <code>/WEB-INF/jsp/clients/add.jsp</code>.</p> <p>O retorno dos métodos do controller são exportados para a view. No caso do nosso método <code>list</code>, como o retorno é uma lista de clientes, a variável acessível no jsp será <code>${clientList}</code>.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">listAll</span><span class="o">():</span>
<span class="o">}</span></code></pre> <p>URI: <code>/clients/list</code> e view: <code>/WEB-INF/jsp/clients/list.jsp</code>.</p> <p>Se o retorno for um tipo simples, o nome da variável exportada será o nome da classe com a primeira letra minúscula. Como o método <code>view</code> retorna um <code>Client</code>, a variável na jsp será <code>${client}</code>. Outro ponto é que devemos ter um parâmetro da requisição <code>id=5</code> por exemplo, e o VRaptor vai fazer a conversão do parâmetro em <code>Long</code>, e passar como parâmetro do método.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="n">Client</span> <span class="nf">view</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>URI: <code>/clients/view</code> e view: <code>/WEB-INF/jsp/clients/view.jsp</code>.</p> <p>Repare como essa classe está completamente independente da API de <code>javax.servlet</code>. O código também está extremamente simples e fácil de ser testado como unidade. O VRaptor já faz várias associações para as URIs como default, por exemplo:</p> <table class="content-table"> <tbody> <tr> <td>/client/form</td> <td>invoca form()</td> </tr> <tr> <td>/client/add</td> <td>invoca add(client) populando o objeto client com os parâmetros da requisição</td> </tr> <tr> <td>/clients/list</td> <td>invoca list() e devolve ${clientList} ao JSP</td> </tr> <tr> <td>/clients/view?id=3</td> <td>invoca view(3l) e devolve ${client} ao JSP</td> </tr> </tbody> </table> <p>Mais para a frente veremos como é fácil trocar a URI <code>/clients/view?id=3</code> por <code>/clients/view/3</code>, deixando a URI mais amigável e elegante.</p> <p>O <code>ClientDao</code> será injetado pelo VRaptor, como também veremos adiante. Você já pode passar para o <a href="../guia-de-10-minutos">Guia inicial de 10 minutos</a>.</p> <h2 id="dvidas">Dúvidas</h2> <p>Se durante a leitura da documentação você tiver dúvidas, procure ajuda no <a href="http://www.guj.com.br/tag/vraptor">GUJ</a> ou acesse nossa <a href="https://groups.google.com/forum/#!forum/caelum-vraptor">lista de discussão</a>.</p> </main> <script src="/js/headers.min.js"></script> </body> </html>