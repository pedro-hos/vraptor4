<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Migrando de um projeto com VRaptor 3</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../guia-de-1-minuto/">Documentação</a></li> <li><a href="../../cookbook/aceitando-urls-com-ou-sem-barra-no-final">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentação</h1> <ul> <li><a href="../guia-de-1-minuto">Guia inicial de 1 minuto</a></li> <li><a href="../guia-de-10-minutos">Guia inicial de 10 minutos</a></li> <li><a href="../controllers-rest">Controllers Rest</a></li> <li><a href="../componentes">Componentes</a></li> <li><a href="../conversores">Conversores</a></li> <li><a href="../validacao">Validação</a></li> <li><a href="../interceptadores">Interceptadores</a></li> <li><a href="../eventos">Eventos</a></li> <li><a href="../trabalhando-com-a-view">Trabalhando com a View</a></li> <li><a href="../download-e-upload">Download e Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencias-e-pre-requisitos">Dependências e pré requisitos</a></li> <li><a href="../testando-componentes-e-controllers">Testando Componentes e Controllers</a></li> <li><a href=".">Migrando de um projeto com VRaptor 3</a></li> <li><a href="../contribuindo-com-o-vraptor">Contribuindo com o VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="migrando-de-um-projeto-com-vraptor-3">Migrando de um projeto com VRaptor 3</h1> <h2 id="java-7-e-cdi-11">Java 7 e CDI 1.1</h2> <p>Para utilizar o VRaptor é necessário possuir o JDK 7 e um Application Server ou Servlet Container que possua suporte ao Servlet 3.1.</p> <h2 id="beansxml">Beans.xml</h2> <p>Como agora o VRaptor usa o CDI como container, para ele conseguir escanear suas classes você precisa adicionar o arquivo <code>beans.xml</code> dentro da pasta <code>META-INF/beans.xml</code> de seu projeto. Se você usa maven, adicione em <code>/src/main/resources/META-INF</code>. Você pode usar como exemplo o arquivo <a href="https://github.com/caelum/vraptor4/blob/master/vraptor-blank-project/src/main/resources/META-INF/beans.xml">beans.xml do nosso blank-project</a>.</p> <h2 id="containers-ioc">Containers IoC</h2> <p>A maior alteração do VRaptor é de usar o CDI (Context Dependency Injection). Com isso não é necessário mais usar os providers anteriores (Guice, Pico e Spring).</p> <p>O CDI <strong>exige</strong> que cada classe possua o construtor padrão (sem argumentos). Sendo assim você deverá adicionar o construtor padrão em todos os componentes. E o construtor onde serão injetados os componentes deve possuir a anotação <code>@Inject</code>.</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MeuController</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MeuComponente</span> <span class="n">meuComponente</span><span class="o">;</span>

    <span class="cm">/** @deprecated Construtor usado apenas para o CDI */</span>
    <span class="kd">protected</span> <span class="nf">MeuController</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">MeuController</span><span class="o">(</span><span class="n">MeuComponente</span> <span class="n">meuComponente</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">meuComponente</span> <span class="o">=</span> <span class="n">meuComponente</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h3 id="static-scanning">Static scanning</h3> <p>Se você usava este recurso, ele não é mais necessário, pois o scanning de classes é feito de forma otmizada pelo CDI. Basta remover as configurações do seu build.</p> <h2 id="eventos-de-inicializao">Eventos de inicialização</h2> <p>No VRaptor 3, quando você anotava um componente com <code>@ApplicationScoped</code>, o código era executado na inicialização do sistema. Com o uso do CDI, agora é necessário usar a anotação <code>@Observes</code>:</p> <pre><code class="language-java"><span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintLog</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">whenApplicationStarts</span><span class="o">(</span><span class="nd">@Observes</span> <span class="n">ServletContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"My application is UP"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="alteraes-em-assinaturas-de-mtodos-e-classes">Alterações em assinaturas de métodos e classes</h2> <p>Muitas classes internas foram atualizadas ou removidas. Se você sobrescreveu algum comportamento interno do VRaptor, verifique em nossa <em>api docs</em> as novas assinaturas.</p> <p>Todos os métodos anotados com <code>@Deprecated</code> do VRaptor 3 foram removidos.</p> <h2 id="ognl">OGNL</h2> <p>Se você usava o OGNL, ele não é mais suportado no VRaptor 4. Atualmente é suportado apenas o IOGI, que possui todas as funcionalidades do OGNL, além de suporte a <code>Set</code> e objetos imutáveis.</p> <h2 id="validao">Validação</h2> <p>A validação fluente foi removida, e agora você pode usar o Bean Validation. Para compatibilidade você pode usar os métodos <code>Validator.check(boolean, Message)</code> para efetuar validações mais simples.</p> <p>A interface <code>Validator</code> foi alterada de pacote, e agora está localizada em <code>br.com.caelum.vraptor.validator.Validator</code>.</p> <p>As classes filhas de <code>Message</code> foram alteradas. A classe <code>ValidationMessage</code> agora é <code>SimpleMessage</code> e o construtor foi alterado para <code>SimpleMessage(String param, String message, Object... params)</code>, mantendo assim compatibilidade com as demais implementações.</p> <h2 id="converters">Converters</h2> <p>Os converters localizados agora fazem parte do pacote padrão, e são registrados automaticamente. Portanto se você tiver a declaração do pacote <code>br.com.caelum.vraptor.converter.l10</code> no seu web.xml, remova-o.</p> <p>Os converters sofreram alterações, e agora não recebem mais o objeto <code>ResourceBundle</code> no método <code>convert</code>. Se você precisa usar algo baseado no <code>Locale</code>, você deve injetá-lo no construtor.</p> <p>A interface Converter foi alterada de pacote, e agora está localizada em br.com.caelum.vraptor.converter.Converter.</p> <h2 id="remoo-dos-escopos">Remoção dos escopos</h2> <p>Nós removemos todos os antigos scopos do core do vraptor. No lugar deles, você pode usar os seguintes escopos definidos no pacote <code>javax.enterprise.context</code>:</p> <pre><code class="language-java"><span class="nd">@javax.enterprise.context.RequestScoped</span>
<span class="nd">@javax.enterprise.context.SessionScoped</span>
<span class="nd">@javax.enterprise.context.ApplicationScoped</span>
<span class="nd">@javax.enterprise.context.ConversationScoped</span>
<span class="nd">@javax.enterprise.context.Dependent</span></code></pre> <p>Uma alternativa simples para migrar os escopos é fazer um replace de <code>br.com.caelum.vraptor.ioc</code> para <code>javax.enterprise.context</code> nos imports.</p> <h2 id="fabricando-de-componentes">Fabricando de componentes</h2> <p>A interface <code>ComponentFactory</code> não existe mais. Desta forma você deve usar o <code>@Produces</code> do CDI. Veja mais no capítulo de componentes.</p> <h2 id="sobrescrevendo-componentes">Sobrescrevendo componentes</h2> <p>No VRaptor3 para sobrescrever os componentes era necessario apenas implementar ou estender a interface ou classe do componente. Por limitações no CDI é necessário agora anotar a sua classe com <code>@Specializes</code>.</p> <h2 id="resource-substitudo-pelo-controller">@Resource substituído pelo @Controller</h2> <p>A anotação <code>@Resource</code> foi substituída pela anotação <code>@Controller</code> e possui o mesmo efeito.</p> <h2 id="no-existe-mais-a-interface-localization">Não existe mais a interface Localization</h2> <p>No lugar de receber a <code>Localization</code> e chamar os métodos <code>.getLocale()</code> ou <code>.getBundle()</code>, agora você pode injetar diretamente esses elementos, algo como:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MinhaClasse</span> <span class="o">{</span>

    <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">;</span>
    <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">ResourceBundle</span> <span class="n">bundle</span><span class="o">;</span>
<span class="o">}</span></code></pre> <p>A maior diferença é que onde você fazia: </p> <pre><code class="language-java"><span class="n">localization</span><span class="o">.</span><span class="na">getBundle</span><span class="o">().</span><span class="na">getMessage</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span></code></pre> <p>Você vai chamar diretamente o <code>getString</code> do bundle:</p> <pre><code class="language-java"><span class="n">bundle</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"key"</span><span class="o">);</span></code></pre> <h2 id="linkto">LinkTo</h2> <p>A funcionalidade LinkTo foi atualizada e agora suporta o uso de métodos nas chamadas. Sendo assim você deve converter todas as chamadas de <code>${linkTo[Controller].metodo[0, 1]}</code> para <code>${linkTo[Controller].metodo(0, 1)}</code>. Veja mais informações no capítulo sobre Views.</p> <p>Pra facilitar a migração deixamos um <code>.sh</code> <a href="https://gist.github.com/rponte/7546377">aqui</a>, que você pode baixar e executar um sed de atualização da sintaxe (para linux e mac, em breve faremos algo pra windows).</p> <h2 id="serializao-e-deserializao">Serialização e deserialização</h2> <p>Para seguir com a especificação do HTML5, todas as datas usadas na serialização e deserialização usam o formato ISO8601.</p> <h2 id="restfulie">Restfulie</h2> <p>Não é suportado mais no core do VRaptor, mas sim como plugin.</p> </main> <script src="/js/headers.min.js"></script> </body> </html>