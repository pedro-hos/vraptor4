<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Conversores</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../guia-de-1-minuto/">Documentação</a></li> <li><a href="../../cookbook/aceitando-urls-com-ou-sem-barra-no-final">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentação</h1> <ul> <li><a href="../guia-de-1-minuto">Guia inicial de 1 minuto</a></li> <li><a href="../guia-de-10-minutos">Guia inicial de 10 minutos</a></li> <li><a href="../controllers-rest">Controllers Rest</a></li> <li><a href="../componentes">Componentes</a></li> <li><a href=".">Conversores</a></li> <li><a href="../validacao">Validação</a></li> <li><a href="../interceptadores">Interceptadores</a></li> <li><a href="../eventos">Eventos</a></li> <li><a href="../trabalhando-com-a-view">Trabalhando com a View</a></li> <li><a href="../download-e-upload">Download e Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencias-e-pre-requisitos">Dependências e pré requisitos</a></li> <li><a href="../testando-componentes-e-controllers">Testando Componentes e Controllers</a></li> <li><a href="../migrando-de-um-projeto-com-vraptor3">Migrando de um projeto com VRaptor 3</a></li> <li><a href="../contribuindo-com-o-vraptor">Contribuindo com o VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="quando-usar-um-conversor">Quando usar um Conversor?</h1> <p>Quando recebemos um parametro do browser, recebemos como uma String. Por isso é necessário um conversor para fazer a tradução deste parametro para seu respectivo objeto. O VRaptor já possui registrado conversores para todos os tipos definidos na <code>Java Language Specification</code>. Para os tipos primitivos, caso o parâmetro seja recebido como <code>null</code>, será retornado o valor padrão do campo. Por exemplo, se você receber um <code>int</code> cujo valor seja <code>null</code>, o converter irá retornar <code>0</code>. Já para os tipos objetos, se o parâmetro recebido for <code>null</code> ou vazio, o valor retornado será <code>null</code>.</p> <p>Por exemplo, se recebermos os seguintes parâmetros do browser: </p> <table class="content-table"> <tbody> <tr> <td>cliente.id</td> <td>10</td> </tr> <tr> <td>cliente.idade</td> <td>null</td> </tr> </tbody> </table> <p>para a classe abaixo:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cliente</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">idade</span><span class="o">;</span>

    <span class="c1">// getters and setters</span>
<span class="o">}</span></code></pre> <p>Ao injetar os dados da requisição na classe, o VRaptor irá usar o conversor <code>LongConverter</code> para o campo <code>id</code> e o conversor <code>PrimitiveIntegerConverter</code> para o campo <code>idade</code>. Neste caso, o atributo <code>id</code> receberá o valor <code>10</code>, e o campo <code>idade</code> receberá o valor <code>0</code>, pois o parametro recebido é <code>null</code>.</p> <p>Você pode obter a lista completa dos conversores padrão do vraptor <a href="http://www.vraptor.org/javadoc/br/com/caelum/vraptor/converter/package-frame.html">aqui</a>.</p> <h2 id="bigdecimal-double-e-float-localizados">BigDecimal, Double e Float localizados</h2> <p>São suportados utilizando o padrão de localização da sua aplicação. <code>Double</code> e <code>Float</code> são suportados tanto o tipo primitivo quanto o tipo objeto.</p> <h2 id="trabalhando-com-datas-e-calendrios">Trabalhando com datas e calendários</h2> <p><code>Calendar</code> e <code>Date</code> são suportados por padrão usando a localização da sua aplicação.</p> <p>Existem conversores para os principais tipos do Joda-time como <code>DateTime</code>, <code>LocalDate</code>, <code>LocalDateTime</code> e <code>LocalTime</code>. Os conversores do Joda-time estão disponíveis usando o plugin <b>vraptor-jodatime</b>. Mais informações <a href="../plugins/#joda-time">aqui</a>.</p> <p>Se você está usando JDK 8, você pode tirar proveito dos conversores do pacote <code>java.time</code>, que estão disponíveis usando o plugin <b>vraptor-javatime</b>. Mais informações <a href="../plugins/#nova-api-de-datas-do-java">aqui</a>.</p> <h2 id="mensagem-de-erro-de-converso">Mensagem de erro de conversão</h2> <p>Quando o VRaptor tenta converter um objeto, e ocorrer algum erro, é retornada para a apicação uma exception indicando o erro de conversão. Por exemplo, se você receber um parametro com valor <code>A</code> para um campo <code>Integer</code>, a conversão irá falhar e você receberá uma <code>ConversionException</code> internacionalizada. Para exibir as mensagens na sua aplicação, basta adicionar as seguintes chaves no seu resource bundle:</p> <pre><code class="language-properties"><span class="na">is_not_a_valid_number</span> <span class="o">=</span> <span class="s">{0} não é um número válido.</span>
<span class="na">is_not_a_valid_integer</span> <span class="o">=</span> <span class="s">{0} não é um inteiro válido.</span>
<span class="na">is_not_a_valid_character</span> <span class="o">=</span> <span class="s">{0} não é um caracter válido.</span>
<span class="na">is_not_a_valid_enum_value</span> <span class="o">=</span> <span class="s">{0} não é uma opção válida.</span>
<span class="na">is_not_a_valid_date</span> <span class="o">=</span> <span class="s">{0} não é uma data válida.</span>
<span class="na">is_not_a_valid_boolean</span> <span class="o">=</span> <span class="s">{0} não é um valor boolean válido.</span>
<span class="na">is_not_a_valid_time</span> <span class="o">=</span> <span class="s">{0} não é um horário válido.</span>
<span class="na">is_not_a_valid_datetime</span> <span class="o">=</span> <span class="s">{0} não é uma data e horário válidos.</span></code></pre> <h2 id="definindo-a-localizao-locale-da-aplicao">Definindo a localização (Locale) da aplicação</h2> <p>A localização dos componentes pode ser alterada utilizando a seguinte configuração no web.xml:</p> <pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>javax.servlet.jsp.jstl.fmt.locale<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>pt_BR<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span></code></pre> <p>Ou vocẽ pode iniciar o servidor de aplicações ou servlet container com o parâmetro:</p> <pre><code>-Duser.language=pt -Duser.region=BR
</code></pre> <h2 id="criando-seu-prprio-converter">Criando seu próprio converter</h2> <p>Todos os conversores devem implementar a interface <code>Converter</code> do vraptor. A classe concreta definirá o tipo que ela é capaz de converter e será invocada com o valor do parâmetro do request e o tipo alvo.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Converter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>Além disso, seu conversor deve ser anotado com o tipo que seu conversor é capaz de converter, para isso utilize a anotação <code>@Convert</code>:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span></code></pre> <p>Por fim, lembre-se de dizer se seu conversor pode ser instanciado em um escopo de <code>Application</code>, <code>Session</code> ou <code>Request</code>, assim como recursos e componentes quaisquer do VRaptor. Por exemplo, um conversor que não requer nenhuma informação do usuário logado pode ser registrado no escopo de <code>Application</code> e instanciado uma única vez:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span></code></pre> <p>A seguir, a implementação de <code>LongConverter</code> mostra como tudo isso pode ser utilizado de maneira bem simples:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isNullOrEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConversionException</span><span class="o">(</span><span class="k">new</span> <span class="n">ConversionMessage</span><span class="o">(</span><span class="s">"is_not_a_valid_integer"</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="populando-outras-propriedades-de-um-objeto-convertido">Populando outras propriedades de um objeto convertido</h2> <p>Nos exemplos acima, usamos os converters para converter um parâmetro do request em um objeto, por exemplo, parâmetro <code>pais</code> converter em um objeto <code>Pais</code>. Porém há casos onde precisamos apenas criar um objeto com alguma propriedade populada. Exemplo: para o parametro <code>pais.nome</code> podemos ter um objeto <code>Pais</code> com o atributo <code>nome</code> preenchido.</p> <p>Neste caso, o <code>value</code> recebido no método será o valor do atributo <code>nome</code>. Basta então criar um converter como no exemplo abaixo:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Pais</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaisConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Pais</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Pais</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Pais</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pais</span> <span class="n">pais</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pais</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">isNullOrEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pais</span><span class="o">.</span><span class="na">setNome</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">pais</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="sobrescrevendo-o-comportamento-dos-conversores-existentes">Sobrescrevendo o comportamento dos conversores existentes</h2> <p>Você pode sobrescrever qualquer converter já existente no VRaptor. Para isso basta estender a classe anotando-a com <code>@Specializes</code>. Um bom exemplo para isso é sobrescrever o conversor <code>LocaleBasedBigDecimalConverter</code> para alterar o formato do valor.</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MeuBigDecimalConverter</span> <span class="kd">extends</span> <span class="n">LocaleBasedBigDecimalConverter</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">NumberFormat</span> <span class="nf">getNumberFormat</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// meu formato</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> </main> <script src="/js/headers.min.js"></script> </body> </html>