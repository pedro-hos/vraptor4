<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Migrating from VRaptor 3</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href="../controllers-rest">REST Controllers</a></li> <li><a href="../components">Components</a></li> <li><a href="../converters">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../interceptors">Interceptors</a></li> <li><a href="../events">Events</a></li> <li><a href="../view-and-ajax">View and Ajax</a></li> <li><a href="../download-and-upload">Download and Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencies-and-prerequisites">Dependencies and prerequisites</a></li> <li><a href="../testing-components-and-controllers">Testing Components and Controllers</a></li> <li><a href=".">Migrating from VRaptor 3</a></li> <li><a href="../contributing-to-vraptor">Contributing to VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="migrating-from-a-vraptor-3-project">Migrating from a VRaptor 3 project</h1> <h2 id="java-7-and-cdi-11">Java 7 and CDI 1.1</h2> <p>To use VRaptor you need a JDK 7 and an Application Server or Servlet Container that supports Servlets 3.1.</p> <h2 id="ioc-containers">IoC Containers</h2> <p>Now VRaptor uses CDI as container. So you don’t need to use Guice, Pico or Spring.</p> <p>CDI spec <strong>obligates</strong> that all managed class have a no-arg constructor. So you need to create a no-arg constructor even you have another constructor annotated with <code>@Inject</code>.</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MyComponent</span> <span class="n">myComponent</span><span class="o">;</span>

    <span class="cm">/** @deprecated CDI eyes only */</span>
    <span class="kd">protected</span> <span class="nf">MyComponent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">MyController</span><span class="o">(</span><span class="n">MyComponent</span> <span class="n">myComponent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">myComponent</span> <span class="o">=</span> <span class="n">myComponent</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h3 id="static-scanning">Static scanning</h3> <p>Since CDI can scan the classpath, this feature is not nedded anymore.</p> <h2 id="startup-events">Startup events</h2> <p>Now to trigger a code when VRaptor starts, you need to observes the event <code>VRaptorInitialized</code> as example below:</p> <pre><code class="language-java"><span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintLog</span> <span class="o">{</span>

    <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">whenApplicationStarts</span><span class="o">(</span><span class="nd">@Observes</span> <span class="n">VRaptorInitialized</span> <span class="n">initialized</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"My application is UP"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="changes-in-classes-and-method-signatures">Changes in classes and method signatures</h2> <p>Some classes and methods was changed or removed. If you have override some internal behaviour, you need to checkout our Javadocs to see what’s changed.</p> <p>All methods and classes annotated with <code>@Deprecated</code> were removed.</p> <h2 id="ognl">OGNL</h2> <p>OGNL support was removed. Now we use IOGI to instantiate parameters, that supports immutable objects, <code>Set</code>s and more. </p> <h2 id="validation">Validation</h2> <p>The fluent validation was removed. From now we only support Bean Validation. For legacy compatibility you can use <code>Validator.addIf(boolean, Message)</code> or <code>Validator.ensure(boolean, Message)</code> to do simple validation.</p> <p>The <code>Validator</code> interface was moved to <code>br.com.caelum.vraptor.validator.Validator</code> package.</p> <p>The inherited classes from <code>Message</code> was changed. <code>ValidationMessage</code> was renamed to <code>SimpleMessage</code> and the constructor was refactored to <code>SimpleMessage(String category, String message, Object... params)</code> signature to keep compatibility if another classes for same package.</p> <h2 id="converters">Converters</h2> <p>All localized converters are merged with non-localized converters. From now on you don’t need to declare these converters in the <code>web.xml</code>.</p> <p>All converters are refactored, and <code>Converter#convert</code> doesn’t have a <code>ResourceBundle</code> parameter anymore. If you need to use some localization features you can inject <code>Locale</code> in the class.</p> <p>The <code>Converter</code> interface was moved to <code>br.com.caelum.vraptor.converter</code> package.</p> <h2 id="vraptor-scopes-removed">VRaptor scopes removed</h2> <p>All VRaptor scopes are removed in flavor to use CDI scopes under package <code>javax.enterprise.context</code>:</p> <pre><code class="language-java"><span class="nd">@javax.enterprise.context.RequestScoped</span>
<span class="nd">@javax.enterprise.context.SessionScoped</span>
<span class="nd">@javax.enterprise.context.ApplicationScoped</span>
<span class="nd">@javax.enterprise.context.ConversationScoped</span>
<span class="nd">@javax.enterprise.context.Dependent</span></code></pre> <h2 id="component-factories">Component factories</h2> <p>The <code>ComponentFactory</code> interface don’t exists anymore. From now you can use <code>@Produces</code> from CDI spec. You can see more <a href="../components">here</a>.</p> <h2 id="overriding-components">Overriding components</h2> <p>Due CDI behaviour you need to annotate your class with <code>@Specializes</code> annotation.</p> <h2 id="resource-is-now-controller">@Resource is now @Controller</h2> <p>The <code>@Resource</code> annotation was renamed to <code>@Controller</code> and has the same behaviour.</p> <h2 id="there-is-no-localization-interface">There is no Localization interface</h2> <p>Instead of using <code>Localization</code> and call <code>.getLocale()</code> or <code>.getBundle()</code> methods, from now you can inject these objects directly like this:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>

    <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">;</span>
    <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">ResourceBundle</span> <span class="n">bundle</span><span class="o">;</span>
<span class="o">}</span></code></pre> <h2 id="linkto">LinkTo</h2> <p>The <strong><em>LinkTo</em></strong> feature was updated, and now supports method sintax. From now instead of using <code>${linkTo[Controller].metodo[0, 1]}</code> you can use <code>${linkTo[Controller].metodo(0, 1)}</code>. More information <a href="../view-and-ajax">here</a>.</p> <p>To easy migration we shared a <code>.sh</code> script <a href="https://gist.github.com/rponte/7546377">here</a>.</p> <h2 id="serialization-and-deserialization">Serialization and deserialization</h2> <p>To stay closer with HTML5 spec, all date and time used with serialization and deserialization uses the ISO8601 format.</p> <h2 id="restfulie">Restfulie</h2> <p>It’s not supported anymore.</p> </main> <script src="/js/headers.min.js"></script> </body> </html>