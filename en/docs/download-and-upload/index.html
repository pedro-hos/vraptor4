<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Download and Upload</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href="../controllers-rest">REST Controllers</a></li> <li><a href="../components">Components</a></li> <li><a href="../converters">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../interceptors">Interceptors</a></li> <li><a href="../events">Events</a></li> <li><a href="../view-and-ajax">View and Ajax</a></li> <li><a href=".">Download and Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencies-and-prerequisites">Dependencies and prerequisites</a></li> <li><a href="../testing-components-and-controllers">Testing Components and Controllers</a></li> <li><a href="../migrating-vraptor3-project">Migrating from VRaptor 3</a></li> <li><a href="../contributing-to-vraptor">Contributing to VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="one-minute-example-download">One minute example: download</h1> <p>The example below explains how to send a download to the browser. Again, see how simple this code is:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileController</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="n">File</span> <span class="nf">picture</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/path/to/userpic."</span> <span class="o">+</span> <span class="n">profile</span><span class="o">.</span><span class="na">getId</span><span class="o">()+</span> <span class="s">".jpg"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="adding-more-download-info">Adding more download info</h2> <p>If you want to add more information about download, you can return a <code>FileDownload</code>:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileController</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Download</span> <span class="nf">picture</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"/path/to/userpic."</span> <span class="o">+</span> <span class="n">profile</span><span class="o">.</span><span class="na">getId</span><span class="o">()+</span> <span class="s">".jpg"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">"image/jpg"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">".jpg"</span><span class="o">;</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">FileDownload</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">filename</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>For situations where you have a <code>InputStream</code>, you can use <code>InputStreamDownload</code>, as you can see below:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="n">Download</span> <span class="nf">picture</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">[...];</span>
    <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">"image/jpg"</span><span class="o">;</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">InputStreamDownload</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">filename</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>You can also use a <code>ByteArrayDownload</code>, if you have a byte array as described below:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="n">Download</span> <span class="nf">picture</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">pictureContent</span> <span class="o">=</span> <span class="o">[...];</span>
    <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">"image/jpg"</span><span class="o">;</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">ByteArrayDownload</span><span class="o">(</span><span class="n">pictureContent</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">filename</span><span class="o">);</span>
<span class="o">}</span></code></pre> <h2 id="upload">Upload</h2> <p>To activate upload support itâ€™s necessary to add <code>commons-upload</code> and <code>commons-io</code> artifacts in your classpath. You can see more info <a href="../dependencies-and-prerequisites#commons-fileupload">here</a>.</p> <h1 id="one-minute-example-upload">One minute example: upload</h1> <p>To receive an uploaded file in your controller, you need to use a parameter as <code>UploadedFile</code>. The <code>UploadedFile</code> class contains the file content as an <code>InputStream</code>. So you can copy to disk (or another location) too easily as you can see in the example below:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">updatePhoto</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">,</span> <span class="n">UploadedFile</span> <span class="n">photo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="na">getFile</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">File</span> <span class="n">savedPhoto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"/path/to/photo/repository"</span><span class="o">,</span> <span class="n">photo</span><span class="o">.</span><span class="na">getFileName</span><span class="o">());</span>
        <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">savedPhoto</span><span class="o">);</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">assign</span><span class="o">(</span><span class="n">savedPhoto</span><span class="o">,</span> <span class="n">profile</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="overriding-upload-settings">Overriding upload settings</h2> <p>You can also change the default upload settings overriding the class <code>MultipartConfig</code>. As example, the default value for an uploaded file is 2MB. But you can easily change this settings.</p> <p>In example below, we can change total allowable upload size (sum of all files).</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomMultipartConfig</span> <span class="kd">extends</span> <span class="n">DefaultMultipartConfig</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSizeLimit</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">;</span> <span class="c1">// 50MB</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre> <p>In the following example we can change the maximum size allowed for each file:</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomMultipartConfig</span> <span class="kd">extends</span> <span class="n">DefaultMultipartConfig</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getFileSizeLimit</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">;</span> <span class="c1">// 50MB</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre> <h2 id="changes-in-form">Changes in form</h2> <p>You need to add the parameter enctype with multipart/form-data value. Without this attribute, the browser cannot upload files:</p> <pre><code class="language-jsp"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"myaction"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span></code></pre> <h2 id="validating-upload">Validating upload</h2> <p>When the maximum size for uploaded file exceeds the configured value, VRaptor add a message on the <code>Validator</code> object.</p> </main> <script src="/js/headers.min.js"></script> </body> </html>