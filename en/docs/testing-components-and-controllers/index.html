<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Testing Components and Controllers</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href="../controllers-rest">REST Controllers</a></li> <li><a href="../components">Components</a></li> <li><a href="../converters">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../interceptors">Interceptors</a></li> <li><a href="../events">Events</a></li> <li><a href="../view-and-ajax">View and Ajax</a></li> <li><a href="../download-and-upload">Download and Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencies-and-prerequisites">Dependencies and prerequisites</a></li> <li><a href=".">Testing Components and Controllers</a></li> <li><a href="../migrating-vraptor3-project">Migrating from VRaptor 3</a></li> <li><a href="../contributing-to-vraptor">Contributing to VRaptor</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="testing-components-and-controllers">Testing Components and Controllers</h1> <p>To do unit tests with VRaptor 4 is often simple, which isn’t so different from unit tests of any class.</p> <p>CDI takes care of your application’s Dependency Injection (DI) and to improve the testability of your class, we advise the dependency injection by constructor, thus you may work easily with mocks, such as:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Validator</span> <span class="n">validator</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">PersonController</span><span class="o">(</span><span class="n">Result</span> <span class="n">result</span><span class="o">,</span> <span class="n">Validator</span> <span class="n">validator</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @deprecated CDI eyes only</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="nf">PersonController</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
    
<span class="o">}</span></code></pre> <p><code>MockResult</code> and <code>MockValidator</code> classes will help you to test your VRaptor’s Controller:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonControllerTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">MockResult</span> <span class="n">result</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">MockValidator</span> <span class="n">validator</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">PersonController</span> <span class="n">controller</span><span class="o">;</span>
    
    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockResult</span><span class="o">();</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockValidator</span><span class="o">();</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PersonController</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">validator</span><span class="o">);</span>
    <span class="o">}</span>
    
<span class="o">}</span></code></pre> <p>If you use field injection Junit by itself will not provide the CDI dependencies for you, since it do not start CDI context. However there are a lot of solutions to help you with that, i.e Arquilian.</p> <p><code>Result</code> and <code>Validator</code> are components almost always present in your Controllers, to make your tests easier, VRaptor provides mocks for these implementations.</p> <h2 id="mockresult">MockResult</h2> <p>The <code>MockResult</code> ignores the redirecting that you do, and collects the included objects, so you can inspect them and make your assertions.</p> <p>Consider the following <code>PersonController</code>’s method:</p> <pre><code class="language-java"><span class="nd">@Post</span><span class="o">(</span><span class="s">"/person/add"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Person</span> <span class="n">person</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">validator</span><span class="o">.</span><span class="na">addIf</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="n">SimpleMessage</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"The name should be filled."</span><span class="o">));</span>
    <span class="n">validator</span><span class="o">.</span><span class="na">onErrorRedirectTo</span><span class="o">(</span><span class="n">IndexController</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">index</span><span class="o">();</span>

    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"success"</span><span class="o">,</span> <span class="s">"Successfully added."</span><span class="o">);</span>
    
    <span class="n">result</span><span class="o">.</span><span class="na">redirectTo</span><span class="o">(</span><span class="n">IndexController</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">index</span><span class="o">();</span>
<span class="o">}</span></code></pre> <p>To test it you can use on your class <code>PersonControllerTest</code> something like:</p> <pre><code class="language-java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldHaveSuccessMessage</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Renan Montenegro"</span><span class="o">);</span>
    
    <span class="n">controller</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
    
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">included</span><span class="o">().</span><span class="na">containsKey</span><span class="o">(</span><span class="s">"success"</span><span class="o">));</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"Successfully added."</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">included</span><span class="o">(</span><span class="s">"success"</span><span class="o">));</span>
<span class="o">}</span></code></pre> <p>Note that any call of the type <code>result.use(...)</code> will be ignored.</p> <h2 id="mockvalidator">MockValidator</h2> <p>The <code>MockValidator</code> will execute the validation accumulating possible errors. To retrieve them you can use the method <code>getErrors()</code> as you can see in the example:</p> <pre><code class="language-java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldThrowValidationException</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">controller</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">());</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">fail</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ValidationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrors</span><span class="o">();</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleMessage</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"The name should be filled."</span><span class="o">)));</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">errors</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>The calling of the method <code>validator.onErrorUse</code>, in case of validation problem, will generate a <code>ValidationException</code>, that can be used as an expected result by your test, as the following:</p> <pre><code class="language-java"><span class="nd">@Test</span><span class="o">(</span><span class="n">expected</span> <span class="o">=</span> <span class="n">ValidationException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldThrowValidationException</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">controller</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">());</span>
<span class="o">}</span></code></pre> </main> <script src="/js/headers.min.js"></script> </body> </html>