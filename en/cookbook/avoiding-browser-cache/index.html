<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Avoiding browser cache</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../../docs/one-minute-guide/">Documentation</a></li> <li><a href="../accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Cookbook</h1> <ul> <li> <a href="../accepting-urls-ending-with-a-slash"> Accepting URLs ending with a slash </a> </li> <li> <a href="../building-a-web-application-with-java8-vraptor4-wildfly"> Building a Web Application with Java 8 and VRaptor4 on Wildfly </a> </li> <li> <a href="."> Avoiding browser cache </a> </li> <li> <a href="../using-the-referer-header-to-redirect"> Using Referer Header to redirect </a> </li> <li> <a href="../integrating-vraptor-with-tiles3"> Integrating VRaptor with Tiles 3 </a> </li> </ul> </nav> <main class="container"> <h1 id="by-otvio-garcia-and-lucas-cavalcanti">by Otávio Garcia and Lucas Cavalcanti</h1> <p>This interceptor will called always, and tells the browser to don’t cache your pages, adding some headers that expires the page.</p> <pre><code class="language-java"><span class="nd">@Intercepts</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoCacheInterceptor</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">NoCacheInterceptor</span><span class="o">(</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * @deprecated CDI eyes only</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="nf">NoCacheInterceptor</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@BeforeCall</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">intercept</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// set the expires to past</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Expires"</span><span class="o">,</span> <span class="s">"Wed, 31 Dec 1969 21:00:00 GMT"</span><span class="o">);</span>

        <span class="c1">// no-cache headers for HTTP/1.1</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Cache-Control"</span><span class="o">,</span> <span class="s">"no-store, no-cache, must-revalidate"</span><span class="o">);</span>

        <span class="c1">// no-cache headers for HTTP/1.1 (IE)</span>
        <span class="n">response</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Cache-Control"</span><span class="o">,</span> <span class="s">"post-check=0, pre-check=0"</span><span class="o">);</span>

        <span class="c1">// no-cache headers for HTTP/1.0</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Pragma"</span><span class="o">,</span> <span class="s">"no-cache"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>If you want to define which pages won’t be cached, you can create an annotation:</p> <pre><code class="language-java"><span class="nd">@Target</span><span class="o">({</span><span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">})</span>
<span class="nd">@Documented</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">NoCache</span> <span class="o">{</span>

<span class="o">}</span></code></pre> <p>And adds the annotation <code>@AcceptsWithAnnotation</code> in the interceptor class.</p> <pre><code class="language-java"><span class="nd">@Intercepts</span>
<span class="nd">@AcceptsWithAnnotation</span><span class="o">(</span><span class="n">NoCache</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoCacheInterceptor</span> <span class="o">{</span>

<span class="o">}</span></code></pre> </main> <script src="/js/headers.min.js"></script> </body> </html>